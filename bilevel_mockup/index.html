<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <title>Index</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
  <style>
    .tooltip {
      position: absolute;
      display: none;
      width: auto;
      height: auto;
      background: none repeat scroll 0 0 white;
      border: 0 none;
      border-radius: 8px 8px 8px 8px;
      box-shadow: -3px 3px 15px #888888;
      color: black;
      font: 12px sans-serif;
      padding: 5px;
      text-align: center;
    }
  </style>
  <div>
    <svg class="chart"></svg>
    <svg class="chart"></svg>
  </div>
  <script>
    // Variables
    var colors = ['#006400', '#00008b', '#8b0000', '#9400d3', '#ff4500', '#008b8b'];
    colors = colors.concat(['#007c00', '#009500', '#00ae00', '#00c800']);
    colors = colors.concat(['#25259e', '#3941b1', '#4a5cc5', '#5879d9']);
    colors = colors.concat(['#a10002', '#b80002', '#cf0002', '#e60001']);
    colors = colors.concat(['#a72bd9', '#ba44de', '#cb5ae3', '#dd6ee9']);
    colors = colors.concat(['#ff5e00', '#ff7300', '#ff8400', '#ff9600']);
    colors = colors.concat(['#00a2a2', '#00b7b7', '#00cfcf', '#00e6e6']);

    var icon_index = 0;
    var icons = ['plugIn_green.png', 'plugOut_red.png'].map(function(icon) {
      return 'icons/' + icon;
    });
    var width = 150;
    var height = 150;
    var radius = Math.min(width, height) / 2 - 1;
    var color = d3.scaleOrdinal(d3.schemeCategory20b);

    var g = d3.selectAll('svg')
      .attr('width', width)
      .attr('height', height)
      .append('g')
      .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

    var partition = d3.partition()
      .size([2 * Math.PI, radius]);
    var tooltip_div = d3.select('body').append('div').attr('class', 'tooltip');

    d3.json('data/data.json', function(error, data) {
      if (error) throw error;

      // Find data root
      var root = d3.hierarchy(data)
        //.sum(function (d) { return d.size});
        .count();
      // Size arcs
      partition(root);
      var arc = d3.arc()
        .startAngle(function(d) {
          return d.x0;
        })
        .endAngle(function(d) {
          return d.x1;
        })
        .innerRadius(function(d) {
          return d.y0;
        })
        .outerRadius(function(d) {
          return d.y1;
        });

      // Put it all together
      g.selectAll('path')
        .data(root.descendants())
        .enter().append('path')
        .attr('display', function(d) {
          return d.depth ? null : 'none';
        })
        .attr('d', arc)
        .style('stroke', '#000000')
        .style('stroke-opacity', 0.4)
        //.style("fill", function (d) {return color((d.children ? d : d.parent).data.name); })
        .style('fill', function(d, i) {
          return (!d.data.name.startsWith('empty')) ? colors[i - 1] : 'none';
        })
        .on('mousemove', function(d, i, j) {
          if (!d.data.name.startsWith('empty')) {
            d3.select(this.parentNode.parentNode).selectAll('path').style('opacity', 0.3);
            d3.select(this).style('opacity', 1);
            if (d.parent.data.name != 'widget') {
              parent_arc_number = 1;
              inner_arcs_size = 6;
              outer_arcs_size = 4;
              arc_pos = inner_arcs_size + outer_arcs_size;
              last_arc_pos = inner_arcs_size * outer_arcs_size + inner_arcs_size;
              while (arc_pos < i && arc_pos <= last_arc_pos) {
                parent_arc_number++;
                arc_pos += 4;
              }
              d3.select(j[parent_arc_number]).style('opacity', 1);
            }
            tooltip_div.style('left', d3.event.pageX + 10 + 'px');
            tooltip_div.style('top', d3.event.pageY - 25 + 'px');
            tooltip_div.style('display', 'inline-block');
            tooltip_div.html('<b>' + (d.data.name) + '</b><br>' + (d.data.description));
          }
        })
        .on('mouseout', function(d) {
          tooltip_div.style('display', 'none');
          d3.selectAll('path')
            .style('opacity', 1);
        });
      g.append('image')
        .attr('width', function() {
          icon_index++;
          //console.log(icon_index, "width")
          return (icon_index % 2 != 0 ? 40 : 34);
        })
        .attr('height', '100%')
        .attr('xlink:href', function(d, i) {
          //console.log(icon_index, "xlink")
          icon = icons[icon_index % 2];
          icon_index++;
          return icon;
        })
        .attr('x', function() {
          //console.log(icon_index, "x")
          icon_index++;
          return (icon_index % 2 != 0 ? -width / 2 + width / 2.5 : -width / 2 + width / 2.6);
        })
        .attr('y', function() {
          //console.log(icon_index, "y")
          icon_index++;
          return (icon_index % 2 != 0 ? -height / 2 - 5 : -height / 2);
        });
    });
  </script>

</body>

</html>